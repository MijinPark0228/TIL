2019.11.13(水) - 新人教育内容

back-end側の処理で遅くなる原因、対策

### １．ロジックが最適化されてない

・無意味な空白

・使ってないプラグイン・メソッドが残っている

・ループ処理が多い / ループの中で配列・オブジェクトを作っている

・重複処理が多い

・未定義のローカル・グローバル変数。値が定義された変数より9倍ほど遅い！

### ２．処理速度が比較的に遅いメソッドを使っている

例）

array_push($array, "orange") → $array[]="orange";

array_search('orange', $array), is_null($array) → isset($array[“orange”])

intval($str) → (int)$str

if($bool === false) → if(!$bool) ※コード規則でダメとされていますが、格納される値が予測可能な変数名を指定していて、値がbooleanの時には使ってもOK

・if(!$result)について
この式の場合、$result=0, $result=falseの両方の場合でtrueになってしまいます。
$resultの値によって、適切に「if(!$result)」か「if($result===false)」を使い分けましょう。
この条件式が正しく動くように、$resultに格納される値にも気を使う必要があります。
なので、八木さんが言ってた通り、変数名も中身がわかりやすい名前をつける必要があります。
$is_memberなら、true/falseと予測されます。
それ以外が格納されていたら、そのように作った人を責めてＯＫ

### ３．最適化されたSQLを書いていない

SELECT 

SELECT * ではなく、必要ではないデータまで取得している
・select * について
アプリサーバーとDBはサーバーを分けて構築することが一般的なため、ネットワーク越しにselectします。
当然select結果もネットワークを経由して返却されるため、テーブルのデータがネットワークを流れます。
流れた分のネットワーク帯域を占有するので、速度低下の原因に繋がります。
道路に車が渋滞する感じです。
・explainを勉強することを強くおすすめします
・DBの仕組を勉強することを強くおすすめします

INDEX・索引を使っていない → ★**EXPLAIN**（実行計画）= クエリーパフォーマンスを確認できる

INSERT・UPDATE

データベースに入れなくてもいいようなデータを入れて、それを更新している

### ４．サーバー構造の問題・言語のバージョンが低い

5. 上記の他レスポンスを遅くする要素
   　・ストレージ速度：今はSSDが主流なので、余り気にする必要はない
   　・アクセス負荷：アクセスが集中するとサーバーの処理が追い付かず、遅くなる。
   　・ネットワーク構成の無駄：サーバーが増えると複雑になります。Firewall, DB, Application, cache, Search Engineなど色々なサーバーが複数個必要になるので、ネットワーク設計を正しく行わないと「輻輳」という現象が発生します。